<div class="card mb-4">
  <header class="card-header">
      <div class="content-header">
          <div>
              <h3 class="content-title card-title">Sales Report </h3>
          </div>
          <div>
              <a href="/admin/generate-pdf" class="btn btn-primary"><i
                      class="text-muted material-icons md-post_add"></i>Generate PDF</a>
              <a onclick="openNewTab()" class="btn btn-primary"><i
                      class="text-muted material-icons md-post_add"></i>Generate Excel</a>
          </div>

          <script>
              function openNewTab() {
                // URL of the page you want to open in a new tab
                var url = "https://example.com/new-page";
              
                // Open a new tab/window with the specified URL
                var newTab = window.open(url, "_blank");
              
                // Ensure the popup blocker doesn't block the new tab/window
                if (newTab) {
                  newTab.focus(); // Focus on the new tab/window if it was successfully opened
                } else {
                  alert("Popup blocked! Please allow popups for this site to open the page in a new tab.");
                }
              }
              </script>
      </div>
      <div class="row align-items-center">
          <!-- <div class="col-md-3 col-12 me-auto mb-md-0 mb-3">
              <div class="custom_select">
                  <select class="form-select select-nice">
                      <option selected>All Categories</option>
                      <% allCategories.forEach(category => { %>
                          <option><%= category.categoryName %></option>
                          <% }) %>
                     
                  </select>
              </div>
          </div> -->

          <div class="col-md-2 col-12">
              <label for="start_date">Start Date:</label>
              <input type="date" id="start_date" class="form-control">
          </div>
          <div class="col-md-2 col-12">
              <label for="end_date">End Date:</label>
              <input type="date" id="end_date" class="form-control">
          </div>
          <div class="col-md-2 col-12">
              <label for="preset_range">Select Range:</label>
              <select id="preset_range" name="preset_range" class="form-select">
                  <option value="today">Today</option>
                  <option value="last_week">Last One Week</option>
                  <option value="last_month">Last One Month</option>
                  <option value="last_year">Last One Year</option>
                  <!-- Add more preset ranges as needed -->
              </select>
          </div>
          <div class="col-md-2 col-6">
              <div class="custom_select ">
                  <label for="sort">Sort By:</label>
                  <select class="form-select select-nice1 " id="sort">
                      <option selected>Quantity Sold</option>
                      <option>Product Revenue</option>

                  </select>
              </div>
          </div>
          <div class="col-md-4 col-12">
              <a href="#" class="btn btn-primary generate-report" id="generate-report"
                  style="margin-top: 22px;">
                  <i class="text-muted material-icons md-post_add"></i>Generate Report
              </a>
          </div>
      </div>
  </header>
  <div class="card-body">
      <div class="table-responsive   table-container" style="max-height: 500px; overflow-y: scroll;">
          <div class=" table-responsive">
              <table class=" align-middle table table-nowrap mb-0 ">
                  <thead class="table-light  ">
                      <tr>
                          <th class="align-middle" class="text-center" scope="col">Sl. No.</th>

                          </th>
                          <!-- <th scope="col" class="text-center">
                              <div class="form-check align-middle">
                                  <input class="form-check-input" type="checkbox" id="transactionCheck01">
                                  <label class="form-check-label" for="transactionCheck01"></label>
                              </div>
                          </th> -->
                          <th class="align-middle" scope="col">Product Sales</th>
                          <th class="align-middle" scope="col">Quantity Sold</th>
                          <th class="align-middle" scope="col">Product Revenue</th>
                          <th class="align-middle" scope="col">Discounts Applied</th>
                      </tr>
                  </thead>

                  <tbody>
                      <% salesDetails.forEach((sale,index)=> { %>
                          <tr>
                              <td class="text-center">
                                  <%= index +1 %>
                              </td>
                              <td>
                                  <%= sale.productName %>
                              </td>
                              <td>
                                  <%= sale.totalOrders %>
                              </td>
                              <td>&#8377 <%= sale.totalAmount.toLocaleString() %>
                              </td>
                              <td>&#8377 <%= (sale.totalAmountWODiscount -
                                      sale.totalAmount).toLocaleString() %>
                              </td>
                          </tr>
                          <% }) %>

                  </tbody>
              </table>
          </div>
      </div> <!-- table-responsive end// -->
  </div>
  <script>
      const startDateInput = document.getElementById('start_date');
      const endDateInput = document.getElementById('end_date');
      const sortBySelect = document.getElementById('sort');
      const tableBody = document.querySelector('.table tbody');
      const generateReportButton = document.getElementById('generate-report');

      generateReportButton.addEventListener('click', (event) => {
          event.preventDefault(); // Prevent the default link behavior
          updateSalesTable(); // Call the updateSalesTable function to update the table
      });

      async function updateSalesTable() {
          const startDate = startDateInput.value;
          const endDate = endDateInput.value;
          const sortBy = sortBySelect.value;

          try {
              const response = await fetch('/admin/generate-sales-report', {
                  method: 'POST',
                  body: JSON.stringify({
                      startDate,
                      endDate,
                      sortBy,
                  }),
                  headers: {
                      'Content-Type': 'application/json',
                  },
              });
              const data = await response.json();
              tableBody.innerHTML = '';
              data.salesDetails.forEach((salesDetail, index) => {
                  const row = document.createElement('tr');
                  row.innerHTML = `
                  <td class="text-center">${index + 1}</td>
                  <td>${salesDetail.productName}</td>
                  <td>${salesDetail.totalOrders}</td>
                  <td>&#8377 ${salesDetail.totalAmount.toLocaleString()}</td>
                  <td>&#8377 ${(salesDetail.totalAmountWODiscount - salesDetail.totalAmount).toLocaleString()}</td>
              `;
                  tableBody.appendChild(row);
              });
          } catch (error) {
              console.error('Error fetching sales data:', error);
          }
      }

      document.addEventListener('DOMContentLoaded', function () {
          const startDateInputCal = document.getElementById('start_date');
          const endDateInputCal = document.getElementById('end_date');
          const presetRangeSelect = document.getElementById('preset_range');

          // Set default date for start date input to today
          const today = new Date();
          const todayString = today.toISOString().split('T')[0];
          startDateInputCal.value = todayString;
          endDateInputCal.value = todayString;

          // Add event listener to preset range select
          presetRangeSelect.addEventListener('change', () => {
              const selectedPreset = presetRangeSelect.value;
              let startDate;
              let endDate;

              switch (selectedPreset) {
                  case 'today':
                      endDate = todayString;
                      startDate = todayString;
                      break;
                  case 'last_week':
                      endDate = todayString;
                      startDate = new Date(today);
                      startDate.setDate(today.getDate() - 7);
                      startDate = startDate.toISOString().split('T')[0];
                      break;
                  case 'last_month':
                      endDate = todayString;
                      startDate = new Date(today);
                      startDate.setMonth(today.getMonth() - 1);
                      startDate = startDate.toISOString().split('T')[0];
                      break;
                  case 'last_year':
                      endDate = todayString;
                      startDate = new Date(today);
                      startDate.setFullYear(today.getFullYear() - 1);
                      startDate = startDate.toISOString().split('T')[0];
                      break;
                  // Add more cases for additional preset ranges if needed
              }

              // Set the start date and end date inputs
              startDateInputCal.value = startDate;
              endDateInputCal.value = endDate;
          });
      });
  </script>

</div>









<div class="card mb-4">
  <header class="card-header">
      <div class="row align-items-center">
          <div class="col-md-3 col-12 me-auto mb-md-0 mb-3">
              <div class="custom_select">
                  <select class="form-select select-nice">
                      <option selected>All Categories</option>
                      <% allCategories.forEach(category=> { %>
                          <option>
                              <%= category.categoryName %>
                          </option>
                          <% }) %>

                  </select>
              </div>
          </div>
          <div class="col-md-2 col-6">
              <input type="date" class="form-control">
          </div>
          <div class="col-md-2 col-6">
              <div class="custom_select">
                  <select class="form-select select-nice" id="status-select">
                      <option hidden selected>All Status</option>
                      <% statuses.forEach(status=> { %>
                          <option>
                              <%= status %>
                          </option>
                          <% }) %>

                  </select>
              </div>
          </div>
      </div>
  </header>
  <!-- <script>
          document.addEventListener("DOMContentLoaded", function() {
              const selectElement = document.querySelector(".select-nice");
              if (selectElement) {
                  selectElement.addEventListener("change", async () => {
                      const selectedValue = selectElement.value;
                      try {
                          const response = await fetch('/admin/orders/filter', {
                              method: 'POST',
                              headers: {
                                  'Content-Type': 'application/json'
                              },
                              body: JSON.stringify({ category: selectedValue })
                          });
      
                          if (response.ok) {
                              console.log('Orders filtered successfully');
                              const data = await response.json();
                              console.log(data);
                          } else {
                              console.error('Failed to filter orders');
                              // Handle error scenario
                          }
                      } catch (error) {
                          console.error('Error occurred while filtering orders:', error);
                          // Handle error scenario
                      }
                  });
              } else {
                  console.error('Dropdown element not found');
              }
          });
      </script> -->


  <div class="card-body">
      <div class="table-responsive">
          <div class="table-responsive">
              <table class="table align-middle table-nowrap mb-0">
                  <thead class="table-light">
                      <tr>
                          <th scope="col" class="text-center">
                              <div class="form-check align-middle">
                                  <input class="form-check-input" type="checkbox" id="transactionCheck01">
                                  <label class="form-check-label" for="transactionCheck01"></label>
                              </div>
                          </th>
                          <th class="align-middle" scope="col">Order ID</th>
                          <th class="align-middle" scope="col">Billing Name</th>
                          <th class="align-middle" scope="col">Date</th>
                          <th class="align-middle" scope="col">Total</th>
                          <th class="align-middle" scope="col">Payment Status</th>
                          <th class="align-middle" scope="col">Payment Method</th>
                          <th class="align-middle" scope="col">View Details</th>
                      </tr>
                  </thead>
                  <tbody>
                      <% orders.forEach(order=> { %>
                          <tr>
                              <td class="text-center">
                                  <div class="form-check">
                                      <input class="form-check-input" type="checkbox"
                                          id="transactionCheck02">
                                      <label class="form-check-label" for="transactionCheck02"></label>
                                  </div>
                              </td>
                              <td><a href="#" class="fw-bold">#<%= order.orderId %></a> </td>
                              <td>
                                  <%= order.address.name%>
                              </td>
                              <td>
                                  <%= order.orderDate %>
                              </td>
                              <td>&#8377 <%= order.orderTotal.toLocaleString() %>
                              </td>
                              <!-- <td>
                              <span class="badge badge-pill badge-soft-success">Paid</span>
                          </td> -->
                              <td>
                                  <% if (order.paymentMethod==="cod" ) { %>
                                      <% if (order.orderStatus==="pending" ) { %>
                                          <span class="badge rounded-pill alert-warning">Pending</span>
                                          <% } else if (order.orderStatus==="delivered" ) { %>
                                              <span class="badge rounded-pill alert-success">Paid</span>
                                              <% } else if (order.orderStatus==="return-requested" ) { %>
                                                  <span
                                                      class="badge rounded-pill alert-primary">Refunded</span>
                                                  <% } else if (order.orderStatus==="returned" ) { %>
                                                      <span
                                                          class="badge rounded-pill alert-primary">Refunded</span>
                                                      <% } else if (order.orderStatus==="cancelled" ) { %>
                                                          <span
                                                              class="badge rounded-pill alert-danger">Cancelled</span>
                                                          <% } %>
                                                              <% } else { %>
                                                                  <% if (order.orderStatus==="pending" ||
                                                                      order.orderStatus==="delivered" ) {
                                                                      %>
                                                                      <span
                                                                          class="badge rounded-pill alert-success">Paid</span>
                                                                      <% } else if
                                                                          (order.orderStatus==="return-requested"
                                                                          ||
                                                                          order.orderStatus==="cancelled"
                                                                          ) { %>
                                                                          <span
                                                                              class="badge rounded-pill alert-primary">Refunded</span>
                                                                          <% } else if
                                                                              (order.orderStatus==="returned"
                                                                              ) { %>
                                                                              <span
                                                                                  class="badge rounded-pill alert-primary">Refunded</span>
                                                                              <% } %>
                                                                                  <% } %>
                              </td>


                              <td>
                                  <% if(order.paymentMethod==="razorPay" ) {%>
                                      <i class="material-icons md-payment font-xxl text-muted mr-5"></i>
                                      Razorpay
                                      <% } else { %>
                                          <i
                                              class="material-icons md-money font-xxl text-muted mr-5"></i>COD
                                          <% } %>
                              </td>
                              <td>
                                  <a href="" class="btn btn-xs"> View details</a>
                              </td>
                          </tr>
                          <% }) %>
                              <!-- <tr>
                          <td class="text-center">
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="transactionCheck03">
                                  <label class="form-check-label" for="transactionCheck03"></label>
                              </div>
                          </td>
                          <td><a href="#" class="fw-bold">#SK2541</a> </td>
                          <td>Jamal Burnett</td>
                          <td>
                              07 Oct, 2022
                          </td>
                          <td>
                              $380
                          </td>
                          <td>
                              <span class="badge badge-pill badge-soft-danger">Chargeback</span>
                          </td>
                          <td>
                              <i class="material-icons md-payment font-xxl text-muted mr-5"></i> Visa
                          </td>
                          <td>
                              <a href="#" class="btn btn-xs"> View details</a>
                          </td>
                      </tr> -->

                  </tbody>
              </table>
          </div>
      </div> <!-- table-responsive end// -->
  </div>
</div>







<div class="card mb-4">
  <header class="card-header">
      <div class="row align-items-center">
          <div class="col-md-3 col-12 me-auto mb-md-0 mb-3">
              <div class="custom_select">
                  <select class="form-select select-nice">
                      <option selected>All Categories</option>
                      <% allCategories.forEach(category=> { %>
                          <option>
                              <%= category.categoryName %>
                          </option>
                          <% }) %>

                  </select>
              </div>
          </div>
          <div class="col-md-2 col-6">
              <input type="date" class="form-control">
          </div>
          <div class="col-md-2 col-6">
              <div class="custom_select">
                  <select class="form-select select-nice" id="status-select">
                      <option hidden selected>All Status</option>
                      <% statuses.forEach(status=> { %>
                          <option>
                              <%= status %>
                          </option>
                          <% }) %>

                  </select>
              </div>
          </div>
      </div>
  </header>
  <!-- <script>
          document.addEventListener("DOMContentLoaded", function() {
              const selectElement = document.querySelector(".select-nice");
              if (selectElement) {
                  selectElement.addEventListener("change", async () => {
                      const selectedValue = selectElement.value;
                      try {
                          const response = await fetch('/admin/orders/filter', {
                              method: 'POST',
                              headers: {
                                  'Content-Type': 'application/json'
                              },
                              body: JSON.stringify({ category: selectedValue })
                          });
      
                          if (response.ok) {
                              console.log('Orders filtered successfully');
                              const data = await response.json();
                              console.log(data);
                          } else {
                              console.error('Failed to filter orders');
                              // Handle error scenario
                          }
                      } catch (error) {
                          console.error('Error occurred while filtering orders:', error);
                          // Handle error scenario
                      }
                  });
              } else {
                  console.error('Dropdown element not found');
              }
          });
      </script> -->


  <div class="card-body">
      <div class="table-responsive">
          <div class="table-responsive">
              <table class="table align-middle table-nowrap mb-0">
                  <thead class="table-light">
                      <tr>
                          <th scope="col" class="text-center">
                              <div class="form-check align-middle">
                                  <input class="form-check-input" type="checkbox" id="transactionCheck01">
                                  <label class="form-check-label" for="transactionCheck01"></label>
                              </div>
                          </th>
                          <th class="align-middle" scope="col">Order ID</th>
                          <th class="align-middle" scope="col">Billing Name</th>
                          <th class="align-middle" scope="col">Date</th>
                          <th class="align-middle" scope="col">Total</th>
                          <th class="align-middle" scope="col">Payment Status</th>
                          <th class="align-middle" scope="col">Payment Method</th>
                          <th class="align-middle" scope="col">View Details</th>
                      </tr>
                  </thead>
                  <tbody>
                      <% orders.forEach(order=> { %>
                          <tr>
                              <td class="text-center">
                                  <div class="form-check">
                                      <input class="form-check-input" type="checkbox"
                                          id="transactionCheck02">
                                      <label class="form-check-label" for="transactionCheck02"></label>
                                  </div>
                              </td>
                              <td><a href="#" class="fw-bold">#<%= order.orderId %></a> </td>
                              <td>
                                  <%= order.address.name%>
                              </td>
                              <td>
                                  <%= order.orderDate %>
                              </td>
                              <td>&#8377 <%= order.orderTotal.toLocaleString() %>
                              </td>
                              <!-- <td>
                              <span class="badge badge-pill badge-soft-success">Paid</span>
                          </td> -->
                              <td>
                                  <% if (order.paymentMethod==="cod" ) { %>
                                      <% if (order.orderStatus==="pending" ) { %>
                                          <span class="badge rounded-pill alert-warning">Pending</span>
                                          <% } else if (order.orderStatus==="delivered" ) { %>
                                              <span class="badge rounded-pill alert-success">Paid</span>
                                              <% } else if (order.orderStatus==="return-requested" ) { %>
                                                  <span
                                                      class="badge rounded-pill alert-primary">Refunded</span>
                                                  <% } else if (order.orderStatus==="returned" ) { %>
                                                      <span
                                                          class="badge rounded-pill alert-primary">Refunded</span>
                                                      <% } else if (order.orderStatus==="cancelled" ) { %>
                                                          <span
                                                              class="badge rounded-pill alert-danger">Cancelled</span>
                                                          <% } %>
                                                              <% } else { %>
                                                                  <% if (order.orderStatus==="pending" ||
                                                                      order.orderStatus==="delivered" ) {
                                                                      %>
                                                                      <span
                                                                          class="badge rounded-pill alert-success">Paid</span>
                                                                      <% } else if
                                                                          (order.orderStatus==="return-requested"
                                                                          ||
                                                                          order.orderStatus==="cancelled"
                                                                          ) { %>
                                                                          <span
                                                                              class="badge rounded-pill alert-primary">Refunded</span>
                                                                          <% } else if
                                                                              (order.orderStatus==="returned"
                                                                              ) { %>
                                                                              <span
                                                                                  class="badge rounded-pill alert-primary">Refunded</span>
                                                                              <% } %>
                                                                                  <% } %>
                              </td>


                              <td>
                                  <% if(order.paymentMethod==="razorPay" ) {%>
                                      <i class="material-icons md-payment font-xxl text-muted mr-5"></i>
                                      Razorpay
                                      <% } else { %>
                                          <i
                                              class="material-icons md-money font-xxl text-muted mr-5"></i>COD
                                          <% } %>
                              </td>
                              <td>
                                  <a href="" class="btn btn-xs"> View details</a>
                              </td>
                          </tr>
                          <% }) %>
                              <!-- <tr>
                          <td class="text-center">
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="transactionCheck03">
                                  <label class="form-check-label" for="transactionCheck03"></label>
                              </div>
                          </td>
                          <td><a href="#" class="fw-bold">#SK2541</a> </td>
                          <td>Jamal Burnett</td>
                          <td>
                              07 Oct, 2022
                          </td>
                          <td>
                              $380
                          </td>
                          <td>
                              <span class="badge badge-pill badge-soft-danger">Chargeback</span>
                          </td>
                          <td>
                              <i class="material-icons md-payment font-xxl text-muted mr-5"></i> Visa
                          </td>
                          <td>
                              <a href="#" class="btn btn-xs"> View details</a>
                          </td>
                      </tr> -->

                  </tbody>
              </table>
          </div>
      </div> <!-- table-responsive end// -->
  </div>
</div>
<!-- <div class="pagination-area mt-30 mb-50">
  <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-start">
          <li class="page-item active"><a class="page-link" href="#">01</a></li>
          <li class="page-item"><a class="page-link" href="#">02</a></li>
          <li class="page-item"><a class="page-link" href="#">03</a></li>
          <li class="page-item"><a class="page-link dot" href="#">...</a></li>
          <li class="page-item"><a class="page-link" href="#">16</a></li>
          <li class="page-item"><a class="page-link" href="#"><i
                      class="material-icons md-chevron_right"></i></a></li>
      </ul>
  </nav>
</div> -->









<td>
  <% if (order.paymentMethod==="cod" ) { %>
      <% if (order.orderStatus==="pending" ) { %>
          <span class="badge rounded-pill alert-warning">Pending</span>
          <% } else if (order.orderStatus==="delivered" ) { %>
              <span class="badge rounded-pill alert-success">Paid</span>
              <% } else if (order.orderStatus==="return-requested" ) { %>
                  <span
                      class="badge rounded-pill alert-primary">Refunded</span>
                  <% } else if (order.orderStatus==="returned" ) { %>
                      <span
                          class="badge rounded-pill alert-primary">Refunded</span>
                      <% } else if (order.orderStatus==="cancelled" ) { %>
                          <span
                              class="badge rounded-pill alert-danger">Cancelled</span>
                          <% } %>
                              <% } else { %>
                                  <% if (order.orderStatus==="pending" ||
                                      order.orderStatus==="delivered" ) {
                                      %>
                                      <span
                                          class="badge rounded-pill alert-success">Paid</span>
                                      <% } else if
                                          (order.orderStatus==="return-requested"
                                          ||
                                          order.orderStatus==="cancelled"
                                          ) { %>
                                          <span
                                              class="badge rounded-pill alert-primary">Refunded</span>
                                          <% } else if
                                              (order.orderStatus==="returned"
                                              ) { %>
                                              <span
                                                  class="badge rounded-pill alert-primary">Refunded</span>
                                              <% } %>
                                                  <% } %>
</td>