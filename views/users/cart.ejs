<%- include('../layouts/header.ejs') %>

    <div class="breadcrumb-area bg-gray-4 "> <!--addd to class for padding - "breadcrumb-padding-1"-->
        <div class="container">
            <div class="breadcrumb-content text-center">
                <h2>Cart</h2>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><i class="ti-angle-right"></i></li>
                    <li>Cart</li>
                </ul>
            </div>
        </div>
        <div class="breadcrumb-img-1">
            <img src="assets/images/banner/breadcrumb-1.png" alt="">
        </div>
        <div class="breadcrumb-img-2">
            <img src="assets/images/banner/breadcrumb-2.png" alt="">
        </div>
    </div>
    <div class="cart-area pt-100 pb-100">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <form action="#">
                        <div class="cart-table-content">
                            <div class="table-content table-responsive">
                                <table>
                                    <thead>
                                        <tr>
                                            <th class="width-thumbnail"></th>
                                            <th class="width-name">Product</th>
                                            <th class="width-price"> Price</th>
                                            <th class="width-quantity">Quantity</th>
                                            <th class="width-subtotal">Subtotal</th>
                                            <th class="width-remove"></th>
                                        </tr>
                                    </thead>
                                    <% cart.cartProducts.forEach(product=> { %>
                                        <tr>
                                            <td class="product-thumbnail">
                                                <a href="/product-details?id=<%=product._id %>"><img
                                                        src="/productAssets/<%= product.product.images[0] %>"
                                                        alt=""></a>
                                            </td>
                                            <td class="product-name">
                                                <h5><a href="/product-details?id=<%=product._id %>">
                                                        <%= product.product.productName %>
                                                    </a></h5>
                                            </td>
                                            <td class="product-cart-price"><span class="amount">₹ <%=
                                                        product.product.productPrice %></span></td>
                                            <td class="cart-quality">
                                                <!-- <div class="product-quality">
                                                    <input class="cart-plus-minus-box input-text qty text"
                                                        name="qtybutton" value="<%= product.quantity %>">
                                                </div> -->
                                                <div class="quantity">
                                                    <button id="decrease_<%= index %>">-</button>
                                                    <input type="number" id="quantity_<%= index %>" data-cart-id="<%= product._id %>"
                                                           data-product-id="<%= product._id %>" value="<%= product.quantity %>">
                                                    <button id="increase_<%= index %>">+</button>
                                                </div>
                                                
                                            </td>
                                            <td class="product-total"><span>₹ <%= (product.product.productPrice *
                                                        product.quantity).toFixed(2) %></span></td>
                                            <td class="product-remove"><a href="#"><i class=" ti-trash "></i></a></td>
                                        </tr>
                                        <% }); %>
                                            </tbody>
                                            <style>
                                                .quantity {
                                                    display: flex;
                                                    align-items: center;
                                                }
                                                .quantity input[type="number"] {
                                                    width: 50px;
                                                    height: 30px;
                                                    border-color: #ccc;
                                                    text-align: center;
                                                    appearance: none; /* Remove default arrow buttons */
                                                    -moz-appearance: textfield; /* Firefox */
                                                }
                                                .quantity input[type="number"]::-webkit-inner-spin-button,
                                                .quantity input[type="number"]::-webkit-outer-spin-button {
                                                    appearance: none; /* Remove default arrow buttons */
                                                    -webkit-appearance: none; /* Safari and Chrome */
                                                }
                                                .quantity button {
                                                    background-color: #eee;
                                                    border: 1px solid #ccc;
                                                    padding: 5px 10px;
                                                    cursor: pointer;
                                                }
                                                .quantity button:first-child {
                                                    border-top-right-radius: 0;
                                                    border-bottom-right-radius: 0;
                                                }
                                                .quantity button:last-child {
                                                    border-top-left-radius: 0;
                                                    border-bottom-left-radius: 0;
                                                }
                                            </style>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="cart-shiping-update-wrapper">
                                    <div class="cart-shiping-update btn-hover">
                                        <a href="#">Continue Shopping</a>
                                    </div>
                                    <div class="cart-clear-wrap">
                                        <!--   -->
                                        <div class="cart-clear btn-hover">
                                            <a href="#">Clear Cart</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-4 col-md-6 col-12">
                    <div class="cart-calculate-discount-wrap mb-40">
                        <h4>Calculate shipping </h4>
                        <div class="calculate-discount-content">
                            <div class="select-style mb-15">
                                <select class="select-two-active">
                                    <option>Bangladesh</option>
                                    <option>Bahrain</option>
                                    <option>Azerbaijan</option>
                                    <option>Barbados</option>
                                    <option>Barbados</option>
                                </select>
                            </div>
                            <div class="select-style mb-15">
                                <select class="select-two-active">
                                    <option>State / County</option>
                                    <option>Bahrain</option>
                                    <option>Azerbaijan</option>
                                    <option>Barbados</option>
                                    <option>Barbados</option>
                                </select>
                            </div>
                            <div class="input-style">
                                <input type="text" placeholder="Town / City">
                            </div>
                            <div class="input-style">
                                <input type="text" placeholder="Postcode / ZIP">
                            </div>
                            <div class="calculate-discount-btn btn-hover">
                                <a class="btn theme-color" href="#">Update</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 col-12">
                    <div class="cart-calculate-discount-wrap mb-40">
                        <h4>Coupon Discount </h4>
                        <div class="calculate-discount-content">
                            <p>Enter your coupon code if you have one.</p>
                            <div class="input-style">
                                <input type="text" placeholder="Coupon code">
                            </div>
                            <div class="calculate-discount-btn btn-hover">
                                <a class="btn theme-color" href="#">Apply Coupon</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-12 col-12">
                    <div class="grand-total-wrap">
                        <div class="grand-total-content">
                            <h3>Subtotal <span>$180.00</span></h3>
                            <div class="grand-shipping">
                                <span>Shipping</span>
                                <ul>
                                    <li><input type="radio" name="shipping" value="info" checked="checked"><label>Free
                                            shipping</label></li>
                                    <li><input type="radio" name="shipping" value="info" checked="checked"><label>Flat
                                            rate: <span>$100.00</span></label></li>
                                    <li><input type="radio" name="shipping" value="info" checked="checked"><label>Local
                                            pickup: <span>$120.00</span></label></li>
                                </ul>
                            </div>
                            <div class="shipping-country">
                                <p>Shipping to Bangladesh</p>
                            </div>
                            <div class="grand-total">
                                <h4>Total <span>$185.00</span></h4>
                            </div>
                        </div>
                        <div class="grand-total-btn btn-hover">
                            <a class="btn theme-color" href="checkout.html">Proceed to checkout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const userId = "<%=userId%>"; // Replace this with the actual user ID
            
            const decreaseButtons = document.querySelectorAll('[id^="decrease_"]');
            const increaseButtons = document.querySelectorAll('[id^="increase_"]');
    
            decreaseButtons.forEach(button => {
                button.addEventListener("click", async () => {
                    const index = button.id.split("_")[1];
                    const quantityInput = document.getElementById(`quantity_${index}`);
                    const productId = quantityInput.dataset.productId;
                    let newQuantity = parseInt(quantityInput.value);
                    if (newQuantity > 0) {
                        newQuantity--;
                        quantityInput.value = newQuantity;
                        await updateCartQuantity(userId, productId, newQuantity);
                    }
                });
            });
    
            increaseButtons.forEach(button => {
                button.addEventListener("click", async () => {
                    const index = button.id.split("_")[1];
                    const quantityInput = document.getElementById(`quantity_${index}`);
                    const productId = quantityInput.dataset.productId;
                    let newQuantity = parseInt(quantityInput.value);
                    newQuantity++;
                    quantityInput.value = newQuantity;
                    await updateCartQuantity(userId, productId, newQuantity);
                });
            });
    
            async function updateCartQuantity(userId, productId, newQuantity) {
                try {
                    const response = await fetch(`/updateCartQuantity?user=${userId}&productId=${productId}&quantity=${newQuantity}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        // You can include credentials if needed
                        credentials: "same-origin"
                    });
                    if (!response.ok) {
                        throw new Error("Error updating cart quantity");
                    }
                    const data = await response.json();
                    console.log(data);
                } catch (error) {
                    console.error("Error updating cart quantity:", error);
                }
            }
        });
    </script>
    
    
      
      
    
    <%- include('../layouts/footer.ejs') %>